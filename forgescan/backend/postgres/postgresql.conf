# PostgreSQL 15 Configuration - Optimized for ForgeScan
# Enforces strict typing, RLS, and business-context-aware queries

# ============================================================================
# MEMORY SETTINGS (tune based on system resources)
# ============================================================================
# Assume 8GB system: shared_buffers ~25% = 2GB, effective_cache = ~75% = 6GB
shared_buffers = 1GB
effective_cache_size = 3GB
maintenance_work_mem = 256MB
work_mem = 16MB

# ============================================================================
# WAL (Write-Ahead Logging) â€” ensure durability
# ============================================================================
wal_buffers = 16MB
checkpoint_completion_target = 0.9
wal_keep_size = 1GB

# ============================================================================
# CONNECTIONS
# ============================================================================
max_connections = 200
superuser_reserved_connections = 5

# ============================================================================
# LOGGING (for audit trail and debugging)
# ============================================================================
log_min_duration_statement = 1000  # Log queries taking > 1 second
log_line_prefix = '%t [%p]: user=%u,db=%d,app=%a,client=%h '
log_timezone = 'UTC'
log_statement = 'all'  # Log all queries (can be noisy; adjust to 'mod' if needed)

# ============================================================================
# STRICTNESS & SECURITY
# ============================================================================
standard_conforming_strings = on
check_function_bodies = on
sql_inheritance = off
constraint_exclusion = partition

# ============================================================================
# TIMEZONE
# ============================================================================
timezone = 'UTC'
datestyle = 'iso, mdy'

# ============================================================================
# QUERY PLANNER
# ============================================================================
random_page_cost = 1.1
effective_io_concurrency = 200

# ============================================================================
# AUTHENTICATION (optional but recommended)
# ============================================================================
# Require password authentication for all connections
password_encryption = 'scram-sha-256'
